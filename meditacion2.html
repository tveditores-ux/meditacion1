<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meditación de Voz Serena</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #e0f2f7, #c1e7f0);
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(160, 230, 235, 0.3) 0%, rgba(160, 230, 235, 0) 70%);
            animation: moveGradient 20s infinite alternate;
        }

        @keyframes moveGradient {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50%, 50%); }
        }

        .container {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 40px;
            width: 90%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            position: relative;
            z-index: 1;
            transform: translateY(0);
            transition: transform 0.5s ease-out;
        }

        .container:hover {
            transform: translateY(-5px);
        }

        h1 {
            color: #2e8b57;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2em;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .subtitle {
            text-align: center;
            color: #5a8c7a;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        textarea {
            width: calc(100% - 20px);
            height: 180px;
            padding: 15px;
            border: 1px solid rgba(46, 139, 87, 0.3);
            border-radius: 15px;
            background-color: rgba(255, 255, 255, 0.6);
            font-size: 1.1em;
            color: #333;
            resize: vertical;
            transition: border-color 0.3s ease-in-out, background-color 0.3s ease-in-out;
            box-shadow: inset 0 1px 5px rgba(0,0,0,0.1);
        }

        textarea:focus {
            border-color: #2e8b57;
            background-color: rgba(255, 255, 255, 0.8);
            outline: none;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group-full {
            grid-column: 1 / -1;
        }

        label {
            color: #2e8b57;
            font-weight: bold;
            font-size: 1em;
            display: flex;
            align-items: center;
        }

        select {
            padding: 10px;
            border: 1px solid rgba(46, 139, 87, 0.3);
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.6);
            font-size: 1em;
            color: #333;
            transition: border-color 0.3s ease-in-out, background-color 0.3s ease-in-out;
        }

        select:focus {
            border-color: #2e8b57;
            background-color: rgba(255, 255, 255, 0.8);
            outline: none;
        }

        input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            height: 10px;
            background: rgba(46, 139, 87, 0.3);
            border-radius: 5px;
            outline: none;
            transition: background 0.3s ease-in-out;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #2e8b57;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: background 0.3s ease-in-out;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background: #3cb371;
        }

        .buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 30px;
            background-color: #4CAF50;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        #musicButton {
            background-color: #20b2aa;
        }

        #musicButton:hover {
            background-color: #1a8b84;
        }

        #stopMusicButton {
            background-color: #ff6b6b;
        }

        #stopMusicButton:hover {
            background-color: #ff5252;
        }

        .icon {
            margin-right: 8px;
            font-size: 1.2em;
        }

        .status {
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.5);
            color: #2e8b57;
            font-weight: bold;
            margin-top: 10px;
        }

        .hidden {
            display: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Meditación de Voz Serena</h1>
        <p class="subtitle">Encuentra tu paz interior con sonidos y voces relajantes</p>

        <textarea id="textToSpeak" placeholder="Pega aquí el texto para tu meditación...">Encuentra una postura cómoda, ya sea sentado o preferiblemente recostado. Permite que tu cuerpo se relaje por completo, sintiendo cómo la superficie te sostiene. Cierra suavemente los ojos. Toma una respiración profunda y al exhalar, deja escapar cualquier tensión que estés sosteniendo desde el día.</textarea>

        <div class="controls-grid">
            <div class="control-group">
                <label for="voiceSelect"><i class="fas fa-user icon"></i>Seleccionar Voz</label>
                <select id="voiceSelect">
                    <option value="">Cargando voces...</option>
                </select>
            </div>

            <div class="control-group">
                <label for="volumeRange"><i class="fas fa-volume-up icon"></i>Volumen Voz: <span id="volumeValue">100%</span></label>
                <input type="range" id="volumeRange" min="0" max="1" step="0.01" value="1">
            </div>

            <div class="control-group">
                <label for="pitchRange"><i class="fas fa-music icon"></i>Tono: <span id="pitchValue">1.0x</span></label>
                <input type="range" id="pitchRange" min="0.5" max="2" step="0.1" value="1">
            </div>

            <div class="control-group">
                <label for="rateRange"><i class="fas fa-tachometer-alt icon"></i>Velocidad: <span id="rateValue">1.0x</span></label>
                <input type="range" id="rateRange" min="0.5" max="2" step="0.1" value="1">
            </div>

            <div class="control-group">
                <label for="musicSelect"><i class="fas fa-music icon"></i>Música de Fondo</label>
                <select id="musicSelect">
                    <option value="none">Sin música</option>
                    <option value="celtic" selected>Música Celta Suave</option>
                    <option value="nature">Sonidos de Naturaleza</option>
                    <option value="piano">Piano Relajante</option>
                    <option value="ambient">Ambiente Etéreo</option>
                    <option value="waves">Olas del Mar</option>
                </select>
            </div>

            <div class="control-group">
                <label for="musicVolumeRange"><i class="fas fa-volume-down icon"></i>Volumen Música: <span id="musicVolumeValue">30%</span></label>
                <input type="range" id="musicVolumeRange" min="0" max="1" step="0.01" value="0.3">
            </div>
        </div>

        <div class="buttons">
            <button id="speakButton"><i class="fas fa-play icon"></i>Reproducir Meditación</button>
            <button id="stopButton"><i class="fas fa-stop icon"></i>Detener Voz</button>
            <button id="musicButton"><i class="fas fa-play-circle icon"></i>Reproducir Música</button>
            <button id="stopMusicButton"><i class="fas fa-stop-circle icon"></i>Detener Música</button>
        </div>

        <div id="status" class="status hidden"></div>
    </div>

    <!-- Elementos de audio para las diferentes músicas -->
    <audio id="celticMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>
    <audio id="natureMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" type="audio/mpeg">
    </audio>
    <audio id="pianoMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" type="audio/mpeg">
    </audio>
    <audio id="ambientMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3" type="audio/mpeg">
    </audio>
    <audio id="wavesMusic" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Elementos DOM
        const textToSpeak = document.getElementById('textToSpeak');
        const speakButton = document.getElementById('speakButton');
        const stopButton = document.getElementById('stopButton');
        const musicButton = document.getElementById('musicButton');
        const stopMusicButton = document.getElementById('stopMusicButton');
        const voiceSelect = document.getElementById('voiceSelect');
        const volumeRange = document.getElementById('volumeRange');
        const pitchRange = document.getElementById('pitchRange');
        const rateRange = document.getElementById('rateRange');
        const musicSelect = document.getElementById('musicSelect');
        const musicVolumeRange = document.getElementById('musicVolumeRange');
        const volumeValue = document.getElementById('volumeValue');
        const pitchValue = document.getElementById('pitchValue');
        const rateValue = document.getElementById('rateValue');
        const musicVolumeValue = document.getElementById('musicVolumeValue');
        const status = document.getElementById('status');

        // Elementos de audio
        const celticMusic = document.getElementById('celticMusic');
        const natureMusic = document.getElementById('natureMusic');
        const pianoMusic = document.getElementById('pianoMusic');
        const ambientMusic = document.getElementById('ambientMusic');
        const wavesMusic = document.getElementById('wavesMusic');

        // Variables globales
        let synth = window.speechSynthesis;
        let utterance = new SpeechSynthesisUtterance();
        let currentMusic = null;
        let voices = [];

        // Inicialización
        function init() {
            loadVoices();
            setupEventListeners();
            setDefaultValues();
        }

        // Cargar voces disponibles
        function loadVoices() {
            // Esperar a que las voces estén cargadas
            const loadVoicesList = () => {
                voices = synth.getVoices();
                populateVoiceSelect();
            };

            if (synth.onvoiceschanged !== undefined) {
                synth.onvoiceschanged = loadVoicesList;
            }
            
            // Intentar cargar inmediatamente
            loadVoicesList();
        }

        // Llenar el selector de voces
        function populateVoiceSelect() {
            voiceSelect.innerHTML = '';
            
            // Filtrar voces en español
            const spanishVoices = voices.filter(voice => 
                voice.lang.startsWith('es') || 
                voice.lang.includes('ES') ||
                voice.lang.includes('Latin') ||
                voice.lang.includes('419')
            );

            if (spanishVoices.length === 0) {
                voiceSelect.innerHTML = '<option value="">No se encontraron voces en español</option>';
                return;
            }

            // Agrupar por género y preferir voces latinas
            const preferredVoices = spanishVoices.filter(voice => 
                voice.name.toLowerCase().includes('latina') ||
                voice.name.toLowerCase().includes('mexican') ||
                voice.name.toLowerCase().includes('mexicana') ||
                voice.lang.includes('419') ||
                voice.lang.includes('MX')
            );

            const otherVoices = spanishVoices.filter(voice => 
                !preferredVoices.includes(voice)
            );

            // Crear opciones para voces preferidas
            preferredVoices.forEach(voice => {
                const option = document.createElement('option');
                option.value = voice.name;
                option.textContent = `${getVoiceGender(voice)} - ${voice.name} (${voice.lang})`;
                option.setAttribute('data-lang', voice.lang);
                voiceSelect.appendChild(option);
            });

            // Separador si hay ambos tipos
            if (preferredVoices.length > 0 && otherVoices.length > 0) {
                const separator = document.createElement('option');
                separator.disabled = true;
                separator.textContent = '────────────';
                voiceSelect.appendChild(separator);
            }

            // Crear opciones para otras voces
            otherVoices.forEach(voice => {
                const option = document.createElement('option');
                option.value = voice.name;
                option.textContent = `${getVoiceGender(voice)} - ${voice.name} (${voice.lang})`;
                option.setAttribute('data-lang', voice.lang);
                voiceSelect.appendChild(option);
            });

            // Seleccionar la primera voz por defecto
            if (voiceSelect.options.length > 0) {
                voiceSelect.value = voiceSelect.options[0].value;
            }
        }

        // Determinar género de la voz
        function getVoiceGender(voice) {
            const name = voice.name.toLowerCase();
            if (name.includes('female') || name.includes('mujer') || name.includes('femenin') || 
                name.includes('mónica') || name.includes('monica') || name.includes('paulina') ||
                name.includes('lucia') || name.includes('luciana') || name.includes('female')) {
                return '👩 Femenina';
            } else if (name.includes('male') || name.includes('hombre') || name.includes('masculin') || 
                       name.includes('jorge') || name.includes('carlos') || name.includes('diego') ||
                       name.includes('male')) {
                return '👨 Masculina';
            } else {
                return '🎭 Neutral';
            }
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Controles de voz
            volumeRange.addEventListener('input', () => {
                utterance.volume = volumeRange.value;
                volumeValue.textContent = `${Math.round(volumeRange.value * 100)}%`;
            });

            pitchRange.addEventListener('input', () => {
                utterance.pitch = pitchRange.value;
                pitchValue.textContent = `${pitchRange.value}x`;
            });

            rateRange.addEventListener('input', () => {
                utterance.rate = rateRange.value;
                rateValue.textContent = `${rateRange.value}x`;
            });

            // Controles de música
            musicVolumeRange.addEventListener('input', () => {
                const volume = musicVolumeRange.value;
                if (currentMusic) {
                    currentMusic.volume = volume;
                }
                musicVolumeValue.textContent = `${Math.round(volume * 100)}%`;
            });

            // Botones
            speakButton.addEventListener('click', speakText);
            stopButton.addEventListener('click', stopSpeech);
            musicButton.addEventListener('click', playMusic);
            stopMusicButton.addEventListener('click', stopMusic);

            // Eventos de síntesis de voz
            utterance.onstart = () => {
                showStatus('Reproduciendo meditación...');
                speakButton.disabled = true;
            };

            utterance.onend = () => {
                showStatus('Meditación completada');
                speakButton.disabled = false;
            };

            utterance.onerror = (event) => {
                showStatus('Error al reproducir: ' + event.error, 'error');
                speakButton.disabled = false;
            };
        }

        // Establecer valores por defecto
        function setDefaultValues() {
            utterance.volume = volumeRange.value;
            utterance.pitch = pitchRange.value;
            utterance.rate = rateRange.value;
        }

        // Reproducir texto
        function speakText() {
            const text = textToSpeak.value.trim();
            if (!text) {
                showStatus('Por favor, introduce el texto para la meditación.', 'error');
                return;
            }

            if (synth.speaking) {
                synth.cancel();
            }

            // Configurar voz seleccionada
            const selectedVoiceName = voiceSelect.value;
            if (selectedVoiceName) {
                const selectedVoice = voices.find(voice => voice.name === selectedVoiceName);
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                }
            }

            utterance.text = text;
            synth.speak(utterance);
        }

        // Detener voz
        function stopSpeech() {
            synth.cancel();
            showStatus('Meditación detenida');
            speakButton.disabled = false;
        }

        // Reproducir música
        function playMusic() {
            const musicType = musicSelect.value;
            
            // Detener música actual
            stopMusic();
            
            if (musicType === 'none') {
                showStatus('Música detenida');
                return;
            }

            // Seleccionar música según la opción
            switch (musicType) {
                case 'celtic':
                    currentMusic = celticMusic;
                    break;
                case 'nature':
                    currentMusic = natureMusic;
                    break;
                case 'piano':
                    currentMusic = pianoMusic;
                    break;
                case 'ambient':
                    currentMusic = ambientMusic;
                    break;
                case 'waves':
                    currentMusic = wavesMusic;
                    break;
            }

            if (currentMusic) {
                currentMusic.volume = musicVolumeRange.value;
                currentMusic.play().then(() => {
                    showStatus(`Reproduciendo: ${musicSelect.options[musicSelect.selectedIndex].text}`);
                }).catch(error => {
                    showStatus('Error al reproducir música: ' + error, 'error');
                });
            }
        }

        // Detener música
        function stopMusic() {
            if (currentMusic) {
                currentMusic.pause();
                currentMusic.currentTime = 0;
            }
            currentMusic = null;
            showStatus('Música detenida');
        }

        // Mostrar estado
        function showStatus(message, type = 'info') {
            status.textContent = message;
            status.className = 'status';
            
            if (type === 'error') {
                status.style.backgroundColor = 'rgba(255, 200, 200, 0.7)';
                status.style.color = '#d32f2f';
            } else {
                status.style.backgroundColor = 'rgba(200, 255, 200, 0.7)';
                status.style.color = '#2e8b57';
            }
            
            status.classList.remove('hidden');
            
            // Ocultar después de 3 segundos
            setTimeout(() => {
                status.classList.add('hidden');
            }, 3000);
        }

        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>